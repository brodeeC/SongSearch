<html>
    <title> Song Search</title>
    <head>
        <script>
            async function html() {
                // Where we want to put search results
                let res = document.getElementById("results");
                res.innerHTML = "";

                //Getting all the variables set up
                let search_field = document.getElementById("searchField").value;

                let sort_order = document.getElementById("sortOrder").value;

                let explicit = document.getElementById("explicit").checked;

                let search_box = document.getElementById("searchBox").value.toLowerCase();

                // Creating the JSON request
                const postHeaders = new Headers();
                postHeaders.append("Content-Type", "application/json");

                const prom = await fetch("http://127.0.0.1:5000/song", {
                    method: "POST",
                    body: JSON.stringify({
                        "searchField": search_field,
                        "sortOrder": sort_order,
                        "includeExp": explicit,
                        "searchBox": search_box
                    }),
                    headers: postHeaders
                });

                const songs = await prom.json();

                // No results
                if (songs.length === 0){
                    res.innerHTML = "<p>No results found.</p>";
                }

                //If there are results
                else{
                    // for each song
                    for (const song of songs){
                        // create its own div
                        let div = document.createElement("div");

                        // create title
                        let title = document.createElement("p");

                        title.appendChild(document.createTextNode(`${song["title"]} by
                        ${song["artists"].join(", ")}`));

                        div.appendChild(title);

                        // genre
                        let genres = document.createElement("p");

                        genres.appendChild(document.createTextNode(`Genres: 
                        ${song["genres"].join(", ")}`));

                        div.appendChild(genres);

                        // popularity score
                        let popularity = document.createElement("p");

                        popularity.appendChild(document.createTextNode(`Popularity
                        score: ${song["popularity"]}`));

                        div.appendChild(popularity);

                        // duration
                        let duration = document.createElement("p");

                        duration.appendChild(document.createTextNode(`Duration:
                        ${song["duration_mins"]} minutes`));

                        div.appendChild(duration);

                        // Link to Spotify
                        let linkPara = document.createElement("p");
                        let link = document.createElement("a");

                        link.setAttribute("href", song["url"]);
                        link.appendChild(document.createTextNode("Listen on Spotify"));

                        linkPara.appendChild(link);
                        div.appendChild(linkPara);

                        // append it all to a page
                        div.appendChild(document.createElement("hr"));
                        res.appendChild(div);
                    }
                }

            }

        </script>

    </head>
   

    <body>
        <h1> Songs Search</h1>
        <p>
        <label for="searchField">Search within:</label>
        <select id="searchField">
            <option value="title">Title</option>
            <option value="artists">Artist</option>
            <option value="genres">Genre</option>
        </select>

        <label for="sortOrder">Sort by:</label>
        <select id="sortOrder">
            <option value="popularity">Popularity Score</option>
            <option value="duration_mins">Duration</option>
        </select>


            Include explicit songs?<input type="checkbox" id=explicit>
            
            <input type="search" id="searchBox" placeholder="Enter Search Terms...">
            <button onclick="html()">Search</button>
        </p>
        <div id = "results">

        </div>
        
    </body>

</html>