<style>
    .show{
        display: block;
    }
    .hidden{
        display: none;
    }
</style>

<html>
    <title> Song Search</title>
    <head>

    </head>
        <script>
            async function html() {
                let res = document.getElementById("results");
                res.innerHTML = "";

                let search_field = document.querySelector("select").value;

                let sort_order = document.getElementById("sort order").value;

                let explicit = document.getElementById("explicit").checked;

                let search_box = document.getElementById("searchBox").value;

                const postHeaders = new Headers();
                postHeaders.append("Content-Type", "application/json");

                const prom = await fetch("/song", {
                    method: "POST",
                    body: JSON.stringify({
                        "searchField": search_field,
                        "sortOrder": sort_order,
                        "includeExp": explicit,
                        "searchBox": search_box
                    }),
                    headers: postHeaders
                });

                const songs = prom.json();

                if (songs.length === 0){
                    res.innerHTML = "No results found.";
                }
                else{
                    for (const song of songs){
                        let div = document.createElement("div");
                        div.setAttribute("class", "song");


                        let titlePara = document.createElement("p");

                        titlePara.appendChild(document.createTextNode(`${song["title"]} by
                        ${song["artists"].join(", ")}`));

                        div.appendChild(titlePara);

                        let genrePara = document.createElement("p");

                        genrePara.appendChild(document.createTextNode(`Genres: 
                        ${song["genres"].join(", ")}`));

                        div.appendChild(genrePara);

                        let popPara = document.createElement("p");

                        popPara.appendChild(document.createTextNode(`Popularity
                        score: ${song["popularity"]}`));

                        div.appendChild(popPara);

                        let durationPara = document.createElement("p");

                        durationPara.appendChild(document.createTextNode(`Duration:
                        ${song["duration_mins"]} minutes`));

                        div.appendChile(durationPara);

                        let linkPara = document.createElement("p");
                        let link = document.createElement("a");

                        link.setAttribute("href", song["url"]);
                        link.appendChild(document.createTextNode("Listen on Spotify"));

                        linkPara.appendChild(link);
                        div.appendChild(linkPara);

                        div.appendChild(document.createElement("hr"));
                        res.appendChild(div);
                    }
                }

            }

        </script>
    
   

    <body>
        <h1> Songs Search</h1>
        <p>
        <label for="search field">Search within:</label>
        <select id="search field">
            <option value="title">Title</option>
            <option value="artists">Artist</option>
            <option value="genres">Genre</option>
        </select>

        <label for="sort order">Sort by:</label>
        <select id="sort order">
            <option value="popularity">Popularity Score</option>
            <option value="duration_mins">Duration</option>
        </select>


            Include explicit songs?<input type="checkbox" id=explicit>
            
            <input type="search" id="searchBox" placeholder="Enter Search Terms...">
            <button onclick="html()">Search</button>
        </p>
        <div id = "results">

        </div>
        
    </body>

</html>